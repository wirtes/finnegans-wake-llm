FROM python:3.10-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    wget \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Upgrade pip and install wheel
RUN pip install --upgrade pip setuptools wheel

# Install minimal dependencies for API only
RUN pip install --no-cache-dir \
    fastapi==0.104.1 \
    uvicorn[standard]==0.24.0 \
    requests==2.31.0 \
    pydantic==2.5.0

# Create a simple mock API for testing
RUN echo 'from fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI(title="Mock Finnegans Wake Translator")\n\nclass TranslationRequest(BaseModel):\n    text: str\n\nclass TranslationResponse(BaseModel):\n    original: str\n    translated: str\n\n@app.get("/")\ndef root():\n    return {"message": "Mock API - Training disabled"}\n\n@app.post("/translate", response_model=TranslationResponse)\ndef translate(request: TranslationRequest):\n    mock_translation = f"Begorra, {request.text} in the style of Joyce, ye ken!"\n    return TranslationResponse(original=request.text, translated=mock_translation)\n\n@app.get("/health")\ndef health():\n    return {"status": "healthy", "model_loaded": False, "mode": "mock"}' > mock_api.py

# Expose API port
EXPOSE 8000

# Run mock API
CMD ["uvicorn", "mock_api:app", "--host", "0.0.0.0", "--port", "8000"]