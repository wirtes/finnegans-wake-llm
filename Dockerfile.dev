FROM python:3.10-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    wget \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Upgrade pip and install wheel
RUN pip install --upgrade pip setuptools wheel

# Install minimal dependencies for API only
RUN pip install --no-cache-dir \
    fastapi==0.104.1 \
    uvicorn[standard]==0.24.0 \
    requests==2.31.0

# Copy only necessary files
COPY api.py .
COPY test_api.py .

# Create a simple mock API for testing
RUN echo 'from fastapi import FastAPI\napp = FastAPI()\n@app.get("/")\ndef root():\n    return {"message": "Mock API - Training disabled"}\n@app.post("/translate")\ndef translate(request: dict):\n    return {"original": request.get("text", ""), "translated": "Mock translation: " + request.get("text", "")}' > mock_api.py

# Expose API port
EXPOSE 8000

# Run mock API
CMD ["uvicorn", "mock_api:app", "--host", "0.0.0.0", "--port", "8000"]